/*
 * us.c
 *
 *  Created on: 18 Oct 2023
 *      Author: maria
 */

#include"icu.h"
#include "us.h"
#include"gpio.h"
#include <util/delay.h>


uint8 g_edges=0;
uint16 totale_time=0;

/*************************************************************************************************
                        Private Functions Prototypes
 ************************************************************************************************/
/*description :
 * Send the Trigger pulse to the ultrasonic.
 */
static void Ultrasonic_Trigger(void);
/*************************************************************************************************
 	 	 	 	 	 	 	 function Definitions
*********************************************************************************************** */
/* description :
 1. Initialize the ICU driver as required.
 2. Setup the ICU call back function.
3. Setup the direction for the trigger pin as output pin through the
GPIO driver
 */
void Ultrasonic_init(void){
	/* call the init fn of the ICU by passing it an object of the configuration  */
	ICU_init(&icu)

	/*set call back fn */
	ICU_setCallBack(Ultrasonic_edgeProcessing);
	/*Setup the direction for the trigger pin as output pin*/
	GPIO_setupPinDirection(TRIGGER_PORT_ID,TRIGGER_PIN_ID,PIN_OUTPUT);
	/* initially set to low */
	GPIO_writePin(TRIGGER_PORT_ID , TRIGGER_PIN_ID , LOGIC_LOW);
}
/*description :
 * Send the Trigger pulse to the ultrasonic.
 */
static  void Ultrasonic_Trigger(void){
	/*semd a trigger pulse for 10usec */
	GPIO_writePin (TRIGGER_PORT_ID,TRIGGER_PIN_ID,LOGIC_HIGH);
	_delay_us(15);
	GPIO_writePin (TRIGGER_PORT_ID,TRIGGER_PIN_ID,LOGIC_LOW);
}
/*description:
 1. Send the trigger pulse by using Ultrasonic_Trigger function.
 2.Start the measurements by the ICU from this moment.
  	  Return: The measured distance in Centimeter.

 */
uint16 Ultrasonic_readDistance(void){
	uint16 distance=0;
	Ultrasonic_Trigger();
	ICU_clearTimerValue();


	if(g_edges==1){

	}
}
/*
 *  Description:
1. This is the call back function called by the ICU driver.
2.This is used to calculate the high time (pulse time) generated by
the ultrasonic sensor.
 *
 */
void Ultrasonic_edgeProcessing(void){
	g_edges++;
	if (g_edges==1){
		totale_time =ICU_getInputCaptureValue();
		ICU_clearTimerValue();
		g_edges=0;
		ICU_setEdgeDetectionType(RAISING);
		flag=1;

	}
}

